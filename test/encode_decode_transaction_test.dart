import 'package:bitcoin_base/bitcoin_base.dart';
import 'package:test/test.dart';

void main() {
  test("test1", () {
    final tx = BtcTransaction(inputs: [
      TxInput(
        txId: "daaa0beab7411cee74768b3f1d7da7ad55fcbc9d835fda0afbe1b9a41ae42f75",
        txIndex: 0,
        scriptSig: Script(
          script: [
            "304402203795e2aa978afbbd676b36c0edd1a39478744d320c5e02dd6a39d154755a5a3e02205545a7765bae3db9b820b1db9be2f8955a8998fa92ac08b0d7416aa30a3cee4241",
            "03ac064f4489ff812c643471ed25b990e6be7212566c932b8680b900c8e6db0fd9"
          ],
        ),
      ),
      TxInput(
          txId: "daaa0beab7411cee74768b3f1d7da7ad55fcbc9d835fda0afbe1b9a41ae42f75",
          txIndex: 2,
          scriptSig: Script(script: [
            "3044022071b39d6aefdea7a7837310e5d78b1069ae82ed007991f8bca80bf3baf26340cc02200bc356be6e9f0019849b75b00322262a23ce179e7c0313207addfdbe596dabfd41",
            "03ac064f4489ff812c643471ed25b990e6be7212566c932b8680b900c8e6db0fd9"
          ]))
    ], outputs: [
      TxOutput(
          amount: BigInt.from(10067000),
          scriptPubKey: Script(
            script: [
              "OP_DUP",
              "OP_HASH160",
              "b8d913342894ec7b066420952a618ec2a8269bc2",
              "OP_EQUALVERIFY",
              "OP_CHECKSIG"
            ],
          )),
      TxOutput(
          amount: BigInt.from(1000),
          cashToken: CashToken(
            category: "4e7873d4529edfd2c6459139257042950230baa9297f111b8675829443f70430",
            bitfield: 16,
            amount: BigInt.from(2000),
          ),
          scriptPubKey: Script(
            script: [
              "OP_HASH256",
              "1d12ffe8e85fdab36794cb09418982efdbd5c8cee5fbeb216ac43887ea4817b8",
              "OP_EQUAL"
            ],
          )),
      TxOutput(
          amount: BigInt.from(1000),
          cashToken: CashToken(
            category: "4e7873d4529edfd2c6459139257042950230baa9297f111b8675829443f70430",
            bitfield: 16,
            amount: BigInt.parse("799999999999996000"),
          ),
          scriptPubKey: Script(
            script: [
              "OP_DUP",
              "OP_HASH160",
              "b8d913342894ec7b066420952a618ec2a8269bc2",
              "OP_EQUALVERIFY",
              "OP_CHECKSIG"
            ],
          )),
    ]);
    const String raw =
        "010000000001072b50f5750fc84801618b558e79d8e3c37d2c513c59cdbb590d90d043d3a9aa83000000001716001496de4122da32c2d428e70b44f8d07f2b26334b6ff0ffffffbcf5ae0a0c5efd15b06b380d59e535cf4fec65150ad301906012ea796f3a4607000000001716001496de4122da32c2d428e70b44f8d07f2b26334b6ff0ffffff4be773c0882999ba5ae2ee574951f926a72037637aeda4344fa37655769ed78d000000001716001496de4122da32c2d428e70b44f8d07f2b26334b6ff0ffffff4b29cb407a116c0c26c73332a3a2dd5e878b3c66dd0bdc516c9b763344cb8119000000001716001496de4122da32c2d428e70b44f8d07f2b26334b6ff0ffffff0b76aceb79e3f2570b82fe4ec5709b5affd04ac9bf7898fdee4a5dac5a429c82000000001716001496de4122da32c2d428e70b44f8d07f2b26334b6ff0ffffff5469f86d1c2ceb0d7da957f6d82d98f3b0f3e4138800fb9f2fb23444476c4ed7000000001716001496de4122da32c2d428e70b44f8d07f2b26334b6ff0ffffffc1fb64b4a9153728ccdfb8f5a2f0d60d42644bb39f0be24408f181c369c9337f000000001716001496de4122da32c2d428e70b44f8d07f2b26334b6ff0ffffff028c43e32e00000000160014455980d0b130ff894536fa79a322db815ab9cde4d9efb0000000000017a914424f29a8a84fa867814ff9ded43379c9dc9a6814870248304502210096990ba2bb32d80dc35ee55548bb300237744e9fdf08fcaf918672c60698da7b02202fe20657730114cdcbe01eef860b537be0b34380505d3d891d741ef2344330ca012102550e8b9eaa471d31c4a544a6aad1d8a3b6e4c4b127ddfdd629e85a888d3f8dd602473044022010699f80eb6495d01ce1b00c70dacc76ed8ea5b1652f9cb04b91456d94cfafe30220111ca2bbb5192ec35247cb6250d1a68f84bf93fe0151f330f20077d3b9b4b5af012102550e8b9eaa471d31c4a544a6aad1d8a3b6e4c4b127ddfdd629e85a888d3f8dd6024730440220170abcd7371d5ac83afff93751e3ea028627d1b38f4bed7da2c897d73d61420402205af8871c7befa740f325deb83483c1450dbcf5388e2836582c8bdaab8bf6a35b012102550e8b9eaa471d31c4a544a6aad1d8a3b6e4c4b127ddfdd629e85a888d3f8dd602483045022100b0702718bc906cf8691b7cbc95baf64e0ab3312a2abfd139b1928715757c0dbc022054f45fbc4cd9517eca6da4771dd8c23e5b0d393e61f5b7dd488086fe24029f80012102550e8b9eaa471d31c4a544a6aad1d8a3b6e4c4b127ddfdd629e85a888d3f8dd602483045022100d8055802be7aabefc62c6f5da69ee556be064c9727c8eab4d6e26ced2f81472c0220294599ad7b030c908923cb3ae1227b2b3f91275e3c00bc4943cdfe1c5e0b6843012102550e8b9eaa471d31c4a544a6aad1d8a3b6e4c4b127ddfdd629e85a888d3f8dd602473044022011a60277e781e891fce3dc920d0f2a0785b0561eb033c54a15a5c06e7c8bfa5a02207bec23c576fcafc1da59936dd6d35e526d3631f20e089f199245a1c4dcf96bb6012102550e8b9eaa471d31c4a544a6aad1d8a3b6e4c4b127ddfdd629e85a888d3f8dd602483045022100c58ee4955ec0d8d84e1b89e4dd4435ab02776dcf5b3b7cb45b837483c157be1002201733ad33460d48e69558bfac47fe045194b3840046c80e4005daff272401d030012102550e8b9eaa471d31c4a544a6aad1d8a3b6e4c4b127ddfdd629e85a888d3f8dd600000000";
    final tr = BtcTransaction.fromRaw(raw);
    print(tr.txId());
    expect(tx.toHex(), raw);
    expect(tr.toHex(), raw);

    /// https://chipnet.imaginary.cash/tx/4ab0ce5507e228ca07a0fc5a75b91714e9855f4e859435dd26a09366ce31e575
  });

  test("test 2", () {
    /// https://tbch4.loping.net/tx/caa91b0fea2843a99c3cd7375ac4d3102b6b74a25e52cd866ad7ecc486204f0d
    const String encodedTr =
        "020000000252b6818f78bff46cbfdf3384875d3471f063f7c49f62658ffa22973c87649b5e000000006c473044022029198caf8776bcf9a8c3fcc79dbd4d3498cd938ba95962e5473fb77ad8d8a6510220265e7a0a14dca7bc1edb0a7bda4cd987f7893377b9cd9cfc9dbef97f85660bed41232103ac064f4489ff812c643471ed25b990e6be7212566c932b8680b900c8e6db0fd9acffffffff52b6818f78bff46cbfdf3384875d3471f063f7c49f62658ffa22973c87649b5e010000006c4730440220639b44bece1b3c2ed597c25497ee6f843ec2de033cb83292e0576b3f84cfc995022032713a60006d76c15bd0a6ddef758c06d61baa5f278bc993d98f03f69165d74741232103ac064f4489ff812c643471ed25b990e6be7212566c932b8680b900c8e6db0fd9acffffffff0510f699000000000023aa209f4ab972963cf18d86aa57fa875147f996916f06c28179f449cd14188818ba3187e80300000000000060efc4bf086c2c7bbb0405343873cf81b8b5d81d65126ce1bcddaa96591e79870d3f72156769746875622e636f6d2f6d72746e6574776f726bfe005a6202aa209f4ab972963cf18d86aa57fa875147f996916f06c28179f449cd14188818ba3187e80300000000000060efc4bf086c2c7bbb0405343873cf81b8b5d81d65126ce1bcddaa96591e79870d3f71156769746875622e636f6d2f6d72746e6574776f726bfe005a6202aa209f4ab972963cf18d86aa57fa875147f996916f06c28179f449cd14188818ba3187e80300000000000060efc4bf086c2c7bbb0405343873cf81b8b5d81d65126ce1bcddaa96591e79870d3f71156769746875622e636f6d2f6d72746e6574776f726bfe005a6202aa209f4ab972963cf18d86aa57fa875147f996916f06c28179f449cd14188818ba3187e80300000000000060efc4bf086c2c7bbb0405343873cf81b8b5d81d65126ce1bcddaa96591e79870d3f71156769746875622e636f6d2f6d72746e6574776f726bfe005a6202aa209f4ab972963cf18d86aa57fa875147f996916f06c28179f449cd14188818ba318700000000";
    final decode = BtcTransaction.fromRaw(encodedTr);
    expect(decode.toHex(), encodedTr);
  });
}
